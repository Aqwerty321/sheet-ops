"use strict";(()=>{var e={};e.id=162,e.ids=[162],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6589:(e,t,s)=>{s.r(t),s.d(t,{originalPathname:()=>v,patchFetch:()=>f,requestAsyncStorage:()=>h,routeModule:()=>u,serverHooks:()=>m,staticGenerationAsyncStorage:()=>g});var o={};s.r(o),s.d(o,{GET:()=>c,POST:()=>l,dynamic:()=>p});var a=s(9303),n=s(8716),r=s(670),i=s(7070);let p="force-dynamic",d=()=>process.env.COMPOSIO_API_KEY||"";async function c(e){let{searchParams:t}=new URL(e.url),s=t.get("userId")||"anonymous",o=t.get("connectedAccountId");try{let e;console.log("Fetching sheets for user:",s,"connectedAccountId:",o);let t=await fetch("https://backend.composio.dev/api/v2/actions/GOOGLESHEETS_LIST_SPREADSHEETS/execute",{method:"POST",headers:{"Content-Type":"application/json","x-api-key":d()},body:JSON.stringify(o?{connectedAccountId:o,input:{}}:{entityId:s,appName:"googlesheets",input:{}})}),a=await t.text();if(console.log("List spreadsheets response:",t.status,a),!t.ok){let e;console.error("Failed to list sheets:",a);let t=await fetch("https://backend.composio.dev/api/v2/actions/GOOGLEDRIVE_LIST_FILES/execute",{method:"POST",headers:{"Content-Type":"application/json","x-api-key":d()},body:JSON.stringify(o?{connectedAccountId:o,input:{q:"mimeType='application/vnd.google-apps.spreadsheet'",pageSize:50}}:{entityId:s,appName:"googledrive",input:{q:"mimeType='application/vnd.google-apps.spreadsheet'",pageSize:50}})});if(!t.ok){let e=await t.text();return console.error("Drive list files also failed:",e),i.NextResponse.json({error:"Failed to list spreadsheets",sheets:[],debug:{sheets:a,drive:e}},{status:200})}let n=await t.text();console.log("Drive list files response:",n);try{e=JSON.parse(n)}catch{return i.NextResponse.json({error:"Invalid drive response",sheets:[],debug:n})}let r=e.data?.files||e.data?.response_data?.files||[];return console.log("Found files from drive:",r.length),i.NextResponse.json({sheets:r.map(e=>({id:e.id,name:e.name}))})}try{e=JSON.parse(a)}catch{return i.NextResponse.json({error:"Invalid response",sheets:[],debug:a})}let n=e.data?.response_data?.files||[];return console.log("Found files from sheets:",n.length),i.NextResponse.json({sheets:n.map(e=>({id:e.id,name:e.name}))})}catch(e){return console.error("List sheets error:",e),i.NextResponse.json({error:"Failed to list spreadsheets",sheets:[]},{status:500})}}async function l(e){let t;try{t=await e.json()}catch{return i.NextResponse.json({error:"Invalid JSON"},{status:400})}let s=t.userId||"anonymous",o=t.sheetId,a=t.range||"A1:Z1000",n=t.connectedAccountId;if(!o)return i.NextResponse.json({error:"sheetId required"},{status:400});let r=n;if(!r)try{let e=await fetch(`https://backend.composio.dev/api/v1/connectedAccounts?entityId=${s}`,{headers:{"x-api-key":d()}});if(e.ok){let t=await e.json(),s=t.items?.find(e=>e.appName?.toLowerCase().includes("sheet")&&"ACTIVE"===e.status);r=s?.id}}catch{}console.log("Fetching sheet data for:",o,"with accountId:",r);try{let e;let t=await fetch("https://backend.composio.dev/api/v2/actions/GOOGLESHEETS_BATCH_GET/execute",{method:"POST",headers:{"Content-Type":"application/json","x-api-key":d()},body:JSON.stringify(r?{connectedAccountId:r,input:{spreadsheet_id:o,ranges:[a]}}:{entityId:s,appName:"googlesheets",input:{spreadsheet_id:o,ranges:[a]}})}),n=await t.text();if(console.log("Sheet data response:",t.status,n.slice(0,500)),!t.ok)return console.error("Failed to get sheet data:",n),i.NextResponse.json({error:"Failed to fetch sheet data",debug:n},{status:200});try{e=JSON.parse(n)}catch{return i.NextResponse.json({error:"Invalid response",debug:n})}let p=e.data?.values||e.data?.valueRanges?.[0]?.values||e.data?.response_data?.valueRanges?.[0]?.values||[];return console.log("Fetched values:",p.length,"rows"),i.NextResponse.json({values:p})}catch(e){return console.error("Get sheet data error:",e),i.NextResponse.json({error:"Failed to fetch sheet data"},{status:500})}}let u=new a.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/composio/sheets/route",pathname:"/api/composio/sheets",filename:"route",bundlePath:"app/api/composio/sheets/route"},resolvedPagePath:"/home/aadit/sheet-ops/app/api/composio/sheets/route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:h,staticGenerationAsyncStorage:g,serverHooks:m}=u,v="/api/composio/sheets/route";function f(){return(0,r.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:g})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),o=t.X(0,[276,972],()=>s(6589));module.exports=o})();