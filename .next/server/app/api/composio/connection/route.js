"use strict";(()=>{var e={};e.id=664,e.ids=[664],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6672:(e,t,o)=>{o.r(t),o.d(t,{originalPathname:()=>g,patchFetch:()=>x,requestAsyncStorage:()=>l,routeModule:()=>u,serverHooks:()=>h,staticGenerationAsyncStorage:()=>m});var n={};o.r(n),o.d(n,{GET:()=>p,POST:()=>d});var s=o(9303),r=o(8716),i=o(670),a=o(7070);let c=()=>process.env.COMPOSIO_API_KEY||"";async function d(e){let t;try{t=await e.json()}catch{return a.NextResponse.json({error:"Invalid JSON"},{status:400})}let o=t.userId||"anonymous",n=t.redirectUrl||"";try{let e;let t=await fetch("https://backend.composio.dev/api/v1/integrations?appName=googlesheets",{headers:{"x-api-key":c()}});if(!t.ok){let e=await t.text();return console.error("Failed to get integrations:",e),a.NextResponse.json({error:"Failed to get integrations",details:e},{status:t.status})}let s=await t.json(),r=s.items?.[0];if(!r)return a.NextResponse.json({error:"Google Sheets integration not found. Set it up in Composio dashboard first."},{status:404});console.log("Found integration:",r.id,r.name);let i=await fetch("https://backend.composio.dev/api/v1/connectedAccounts",{method:"POST",headers:{"Content-Type":"application/json","x-api-key":c()},body:JSON.stringify({integrationId:r.id,entityId:o,redirectUri:n,data:{}})}),d=await i.text();if(console.log("Composio connection response:",i.status,d),!i.ok)return a.NextResponse.json({error:"Failed to create connection",details:d},{status:i.status});try{e=JSON.parse(d)}catch{return a.NextResponse.json({error:"Invalid response from Composio",details:d},{status:500})}let p=e.redirectUrl;if(!p)return console.error("No redirect URL in response:",e),a.NextResponse.json({error:"No redirect URL returned. Check Composio integration setup.",details:e},{status:500});return a.NextResponse.json({ok:!0,redirectUrl:p,connectionId:e.connectionId||e.id})}catch(e){return console.error("Composio connection error:",e),a.NextResponse.json({error:"Failed to initiate connection",details:String(e)},{status:500})}}async function p(e){let{searchParams:t}=new URL(e.url),o=t.get("userId")||"anonymous";try{let e=await fetch(`https://backend.composio.dev/api/v1/connectedAccounts?entityId=${o}`,{headers:{"x-api-key":c()}});if(!e.ok)return a.NextResponse.json({connected:!1,error:"Failed to check connection"},{status:e.status});let t=await e.json();console.log("Connected accounts for",o,":",JSON.stringify(t.items,null,2));let n=t.items?.find(e=>{let t=(e.appName||e.appUniqueId||"").toLowerCase(),o=t.includes("sheet")||t.includes("google"),n="ACTIVE"===e.status;return console.log(`  Account: ${t}, status: ${e.status}, isSheets: ${o}, isActive: ${n}`),o&&n});return console.log("Sheets connection found:",!!n,"id:",n?.id),a.NextResponse.json({connected:!!n,connectedAccountId:n?.id,accounts:t.items||[]})}catch(e){return console.error("Connection status check error:",e),a.NextResponse.json({connected:!1,error:"Failed to check connection"},{status:500})}}let u=new s.AppRouteRouteModule({definition:{kind:r.x.APP_ROUTE,page:"/api/composio/connection/route",pathname:"/api/composio/connection",filename:"route",bundlePath:"app/api/composio/connection/route"},resolvedPagePath:"/home/aadit/sheet-ops/app/api/composio/connection/route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:l,staticGenerationAsyncStorage:m,serverHooks:h}=u,g="/api/composio/connection/route";function x(){return(0,i.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:m})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var o=e=>t(t.s=e),n=t.X(0,[276,972],()=>o(6672));module.exports=n})();