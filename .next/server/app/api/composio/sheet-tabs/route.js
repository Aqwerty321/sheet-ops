"use strict";(()=>{var e={};e.id=703,e.ids=[703],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6789:(e,t,s)=>{s.r(t),s.d(t,{originalPathname:()=>m,patchFetch:()=>g,requestAsyncStorage:()=>h,routeModule:()=>c,serverHooks:()=>l,staticGenerationAsyncStorage:()=>u});var o={};s.r(o),s.d(o,{GET:()=>d});var a=s(9303),n=s(8716),r=s(670),i=s(7070);let p=()=>process.env.COMPOSIO_API_KEY||"";async function d(e){let{searchParams:t}=new URL(e.url),s=t.get("spreadsheetId"),o=t.get("connectedAccountId"),a=t.get("userId")||"anonymous";if(!s)return i.NextResponse.json({error:"spreadsheetId required"},{status:400});console.log("Fetching sheet tabs for:",s,"accountId:",o);try{let e=await fetch("https://backend.composio.dev/api/v2/actions/GOOGLESHEETS_GET_SPREADSHEET_INFO/execute",{method:"POST",headers:{"Content-Type":"application/json","x-api-key":p()},body:JSON.stringify(o?{connectedAccountId:o,input:{spreadsheet_id:s}}:{entityId:a,appName:"googlesheets",input:{spreadsheet_id:s}})}),t=await e.text();if(console.log("Get spreadsheet info response:",e.status,t.slice(0,800)),e.ok)try{let e=JSON.parse(t),s=e.data?.sheets||e.data?.response_data?.sheets||[];if(s.length>0){let e=s.map(e=>({id:e.properties?.sheetId??0,name:e.properties?.title??"Sheet1"}));return console.log("Found tabs from info:",e.map(e=>e.name)),i.NextResponse.json({tabs:e})}}catch{}console.log("Trying fallback: BATCH_GET to detect sheet names...");let n=["Sheet1","Sheet2","Sheet3","Data","Main"],r=[];for(let e=0;e<n.length;e++){let t=n[e],i=await fetch("https://backend.composio.dev/api/v2/actions/GOOGLESHEETS_BATCH_GET/execute",{method:"POST",headers:{"Content-Type":"application/json","x-api-key":p()},body:JSON.stringify(o?{connectedAccountId:o,input:{spreadsheet_id:s,ranges:[`${t}!A1:A1`]}}:{entityId:a,appName:"googlesheets",input:{spreadsheet_id:s,ranges:[`${t}!A1:A1`]}})});if(i.ok){let s=await i.text();s.includes("Unable to parse range")||s.includes("not found")||r.push({id:e,name:t})}if(r.length>0&&e>=r.length+1)break}if(r.length>0)return console.log("Detected tabs via BATCH_GET:",r.map(e=>e.name)),i.NextResponse.json({tabs:r});return console.log("No tabs detected, returning default Sheet1"),i.NextResponse.json({tabs:[{id:0,name:"Sheet1"}]})}catch(e){return console.error("Get sheet tabs error:",e),i.NextResponse.json({tabs:[{id:0,name:"Sheet1"}]})}}let c=new a.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/composio/sheet-tabs/route",pathname:"/api/composio/sheet-tabs",filename:"route",bundlePath:"app/api/composio/sheet-tabs/route"},resolvedPagePath:"/home/aadit/sheet-ops/app/api/composio/sheet-tabs/route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:h,staticGenerationAsyncStorage:u,serverHooks:l}=c,m="/api/composio/sheet-tabs/route";function g(){return(0,r.patchFetch)({serverHooks:l,staticGenerationAsyncStorage:u})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),o=t.X(0,[276,972],()=>s(6789));module.exports=o})();