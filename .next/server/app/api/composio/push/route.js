"use strict";(()=>{var e={};e.id=37,e.ids=[37],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4599:(e,t,o)=>{o.r(t),o.d(t,{originalPathname:()=>f,patchFetch:()=>m,requestAsyncStorage:()=>d,routeModule:()=>c,serverHooks:()=>g,staticGenerationAsyncStorage:()=>h});var s={};o.r(s),o.d(s,{POST:()=>l});var a=o(9303),n=o(8716),r=o(670),p=o(7070);let i=()=>process.env.COMPOSIO_API_KEY||"";function u(e){let t="",o=e;for(;o>0;)t=String.fromCharCode(65+--o%26)+t,o=Math.floor(o/26);return t||"A"}async function l(e){let t;try{t=await e.json()}catch{return p.NextResponse.json({error:"Invalid JSON"},{status:400})}let o=t.userId||"anonymous",s=t.sheetId,a=t.sheetName||"Sheet1";if(console.log("Push request:",{userId:o,sheetId:s,sheetName:a,hasConnectedAccountId:!!t.connectedAccountId,hasFullData:!!t.fullData,dataRows:t.fullData?.length}),!s)return p.NextResponse.json({error:"sheetId required"},{status:400});try{let e=e=>t.connectedAccountId?(console.log("Using connectedAccountId:",t.connectedAccountId),{connectedAccountId:t.connectedAccountId,input:e}):(console.log("Using entityId + appName:",o),{entityId:o,appName:"googlesheets",input:e});if(t.fullData&&t.fullData.length>0){let o=`${a}!A1:${u(t.fullData[0]?.length||1)}${t.fullData.length}`;console.log("Update range:",o),console.log("Clearing sheet first...");let n=await fetch("https://backend.composio.dev/api/v2/actions/GOOGLESHEETS_CLEAR_VALUES/execute",{method:"POST",headers:{"Content-Type":"application/json","x-api-key":i()},body:JSON.stringify(e({spreadsheet_id:s,range:`${a}!A1:Z1000`}))}),r=await n.text();console.log("Clear response:",n.status,r.slice(0,200));let l=await fetch("https://backend.composio.dev/api/v2/actions/GOOGLESHEETS_BATCH_UPDATE/execute",{method:"POST",headers:{"Content-Type":"application/json","x-api-key":i()},body:JSON.stringify(e({spreadsheet_id:s,sheet_name:a,range:o,values:t.fullData,value_input_option:"RAW"}))}),c=await l.text();if(console.log("Composio batch update response:",l.status,c.slice(0,500)),!l.ok)return console.error("Failed to push full data:",c),p.NextResponse.json({error:"Failed to push changes",details:c},{status:l.status});return p.NextResponse.json({ok:!0,updated:t.fullData.length})}if(t.updates&&t.updates.length>0){let o=t.updates.map(e=>({range:`${u(e.col)}${e.row}`,values:[[e.value]]})),a=await fetch("https://backend.composio.dev/api/v2/actions/GOOGLESHEETS_BATCH_UPDATE_VALUES/execute",{method:"POST",headers:{"Content-Type":"application/json","x-api-key":i()},body:JSON.stringify(e({spreadsheet_id:s,data:o,value_input_option:"RAW"}))});if(!a.ok){let e=await a.text();return console.error("Failed to push updates:",e),p.NextResponse.json({error:"Failed to push changes",details:e},{status:a.status})}return p.NextResponse.json({ok:!0,updated:t.updates.length})}return p.NextResponse.json({error:"No updates provided"},{status:400})}catch(e){return console.error("Push error:",e),p.NextResponse.json({error:"Failed to push changes"},{status:500})}}let c=new a.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/composio/push/route",pathname:"/api/composio/push",filename:"route",bundlePath:"app/api/composio/push/route"},resolvedPagePath:"/home/aadit/sheet-ops/app/api/composio/push/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:d,staticGenerationAsyncStorage:h,serverHooks:g}=c,f="/api/composio/push/route";function m(){return(0,r.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:h})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var o=e=>t(t.s=e),s=t.X(0,[276,972],()=>o(4599));module.exports=s})();