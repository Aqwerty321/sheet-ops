(()=>{var e={};e.id=570,e.ids=[570],e.modules={2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},4703:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>l.a,__next_app__:()=>u,originalPathname:()=>m,pages:()=>c,routeModule:()=>h,tree:()=>d}),r(4280),r(3460),r(5866);var a=r(3191),s=r(8716),n=r(7922),l=r.n(n),o=r(5231),i={};for(let e in o)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(i[e]=()=>o[e]);r.d(t,i);let d=["",{children:["sheet",{children:["[sheetId]",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,4280)),"/home/aadit/sheet-ops/app/sheet/[sheetId]/page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(r.bind(r,3460)),"/home/aadit/sheet-ops/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,5866,23)),"next/dist/client/components/not-found-error"]}],c=["/home/aadit/sheet-ops/app/sheet/[sheetId]/page.tsx"],m="/sheet/[sheetId]/page",u={require:r,loadChunk:()=>Promise.resolve()},h=new a.AppPageRouteModule({definition:{kind:s.x.APP_PAGE,page:"/sheet/[sheetId]/page",pathname:"/sheet/[sheetId]",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},5447:(e,t,r)=>{Promise.resolve().then(r.bind(r,2449))},2647:(e,t,r)=>{Promise.resolve().then(r.bind(r,242))},987:(e,t,r)=>{Promise.resolve().then(r.t.bind(r,2994,23)),Promise.resolve().then(r.t.bind(r,6114,23)),Promise.resolve().then(r.t.bind(r,9727,23)),Promise.resolve().then(r.t.bind(r,9671,23)),Promise.resolve().then(r.t.bind(r,1868,23)),Promise.resolve().then(r.t.bind(r,4759,23))},8958:(e,t,r)=>{"use strict";r.d(t,{Z:()=>s});var a=r(326);function s({children:e,className:t}){return a.jsx("div",{className:`bg-white text-black rounded-lg border-2 border-black p-6 shadow-[10px_10px_0_rgba(0,0,0,0.15)] ${t??""}`,children:e})}},2449:(e,t,r)=>{"use strict";r.d(t,{default:()=>l});var a=r(326),s=r(7577);let n=({sparkColor:e="#ffffff00",sparkSize:t=10,sparkRadius:r=15,sparkCount:n=8,duration:l=400,easing:o="ease-out",extraScale:i=1,children:d})=>{let c=(0,s.useRef)(null),m=(0,s.useRef)([]),u=(0,s.useRef)(null),h=(0,s.useCallback)(e=>{switch(o){case"linear":return e;case"ease-in":return e*e;case"ease-in-out":return e<.5?2*e*e:-1+(4-2*e)*e;default:return e*(2-e)}},[o]);return(0,s.useEffect)(()=>{let a,s;let o=document.createElement("canvas");c.current=o,o.style.position="fixed",o.style.inset="0",o.style.width="100vw",o.style.height="100vh",o.style.pointerEvents="none",o.style.zIndex="9999",document.body.appendChild(o);let d=o.getContext("2d");if(!d)return;let p=()=>{let e=window.innerWidth,t=window.innerHeight;o.width=Math.floor(e),o.height=Math.floor(t)},x=()=>{clearTimeout(a),a=setTimeout(p,100)},g=e=>{let t=performance.now(),r=Array.from({length:n},(r,a)=>({x:e.clientX,y:e.clientY,angle:2*Math.PI*a/n,startTime:t}));m.current.push(...r)},b=a=>{u.current||(u.current=a),d.clearRect(0,0,o.width,o.height),m.current=m.current.filter(s=>{let n=a-s.startTime;if(n>=l)return!1;let o=h(n/l),c=o*r*i,m=t*(1-o),u=s.x+c*Math.cos(s.angle),p=s.y+c*Math.sin(s.angle),x=s.x+(c+m)*Math.cos(s.angle),g=s.y+(c+m)*Math.sin(s.angle);return d.strokeStyle=e,d.lineWidth=2,d.beginPath(),d.moveTo(u,p),d.lineTo(x,g),d.stroke(),!0}),s=requestAnimationFrame(b)};return window.addEventListener("resize",x),window.addEventListener("pointerdown",g),p(),s=requestAnimationFrame(b),()=>{window.removeEventListener("resize",x),window.removeEventListener("pointerdown",g),clearTimeout(a),cancelAnimationFrame(s),o.remove()}},[e,t,r,n,l,h,i]),a.jsx("div",{className:"relative w-full min-h-screen",children:d})};function l({children:e}){return a.jsx(n,{sparkColor:"#000000",sparkSize:21,sparkRadius:15,sparkCount:7,duration:400,children:a.jsx("div",{className:"min-h-screen w-full",children:e})})}},242:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>w});var a=r(326),s=r(7577);function n({from:e,text:t}){let r="user"===e;return a.jsx("div",{className:`flex ${r?"justify-end":"justify-start"}`,children:a.jsx("div",{className:`max-w-[85%] rounded-lg p-3 text-sm ${r?"bg-gray-800 text-white":"bg-gray-100 text-black"}`,children:t})})}function l({sheetName:e}){return(0,a.jsxs)("div",{className:"flex h-full flex-col overflow-hidden",children:[(0,a.jsxs)("div",{className:"mb-4 flex items-center justify-between",children:[a.jsx("div",{className:"text-lg font-semibold",children:"Agent"}),(0,a.jsxs)("div",{className:"flex items-center gap-2 text-xs text-gray-500",children:[a.jsx("span",{className:"h-2 w-2 rounded-full bg-yellow-400 animate-pulse"}),"Connecting..."]})]}),(0,a.jsxs)("div",{className:"flex-1 flex flex-col items-center justify-center space-y-4 px-4",children:[(0,a.jsxs)("div",{className:"text-center space-y-2",children:[a.jsx("h3",{className:"font-semibold text-gray-800",children:"Connecting to Sheet"}),a.jsx("p",{className:"text-sm text-gray-600",children:e})]}),(0,a.jsxs)("div",{className:"flex justify-center items-center space-x-1",children:[a.jsx("div",{className:"h-2 w-2 bg-blue-500 rounded-full animate-bounce",style:{animationDelay:"0s"}}),a.jsx("div",{className:"h-2 w-2 bg-blue-500 rounded-full animate-bounce",style:{animationDelay:"0.1s"}}),a.jsx("div",{className:"h-2 w-2 bg-blue-500 rounded-full animate-bounce",style:{animationDelay:"0.2s"}})]}),a.jsx("p",{className:"text-xs text-gray-500 text-center max-w-xs",children:"Sending spreadsheet context to the agent and waiting for confirmation..."})]}),a.jsx("div",{className:"flex flex-col gap-2 border-t border-gray-100 bg-white p-2",children:a.jsx("div",{className:"rounded-md bg-gray-100 px-3 py-1.5 text-sm text-gray-500 text-center",children:"Please wait..."})})]})}function o({mode:e,pendingOps:t,columns:r,rows:o,sheetId:i,sheetName:d,tabName:c,userId:m,validationIssues:u,onProposeOps:h,onPreview:p,onRun:x,onAgentComplete:g}){let[b,f]=(0,s.useState)(""),[w,y]=(0,s.useState)([{id:"m1",from:"agent",text:"Connect to a sheet to get started. Once connected, I can help you edit, clean, and transform your data."}]),[j,v]=(0,s.useState)("idle"),[N,S]=(0,s.useState)(null),[I,C]=(0,s.useState)(!1),[$,k]=(0,s.useState)(null),[_,D]=(0,s.useState)(!1),[O,P]=(0,s.useState)(!1),A=(0,s.useRef)(null),E=(0,s.useRef)(null),T=async()=>{if(i){D(!0),P(!1),k({id:i,name:d||`Sheet ${i.slice(0,8)}...`});try{let e={type:"CONTEXT",spreadsheetId:i,spreadsheetName:d||`Sheet ${i.slice(0,8)}...`,tabName:c||"Sheet1",connectedAccountId:m||"anonymous",columns:r.map((e,t)=>({letter:String.fromCharCode(65+t),name:e.label,id:e.id})),dataTypes:r.reduce((e,t)=>(e[t.label]="text",e),{}),currentData:o.slice(0,10).map((e,t)=>({rowIndex:t+1,rowId:e.id,values:r.map(t=>e.cells[t.id]||"")})),rowCount:o.length,note:"Row indices are 1-based. Use rowIndex value when specifying row in operations."};E.current&&E.current.abort(),E.current=new AbortController;let t={id:`ctx-${Date.now()}`,from:"user",text:JSON.stringify(e,null,2)};y(e=>[...e,t]);let a=`a-ctx-${Date.now()}`;y(e=>[...e,{id:a,from:"agent",text:"",isStreaming:!0}]);let s=await fetch("/api/chat/proxy",{method:N?"PUT":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:JSON.stringify(e),runId:N,userId:m||"anonymous"}),signal:E.current.signal});if(!s.ok)throw Error(`Request failed: ${s.status}`);let n=s.headers.get("X-Toolhouse-Run-ID");n&&S(n);let l=s.body?.getReader();if(!l)throw Error("No response body");let u=new TextDecoder,h="";for(;;){let{done:e,value:t}=await l.read();if(e)break;let r=u.decode(t,{stream:!0});h+=r,y(e=>e.map(e=>e.id===a?{...e,text:h}:e))}y(e=>e.map(e=>e.id===a?{...e,isStreaming:!1}:e));try{let e=h.match(/```json\s*([\s\S]*?)```/);if(e){let t=JSON.parse(e[1]);if("CONNECTED"===t.status&&!0===t.confirmed)P(!0);else throw Error("Agent did not confirm connection")}else throw Error("No JSON response from agent")}catch(e){console.error("Connection confirmation failed:",e),D(!1),k(null),y(e=>[...e,{id:`err-${Date.now()}`,from:"agent",text:"Failed to connect to the agent. Please try again."}]);return}}catch(e){if("AbortError"===e.name)return;console.error("Connection error:",e),k(null),y(t=>[...t,{id:`err-${Date.now()}`,from:"agent",text:`Connection failed: ${e.message}`}])}finally{D(!1),E.current=null}}},R=(0,s.useCallback)(e=>{let t=[],a=e=>{let t=0;for(let r=0;r<e.length;r++)t=26*t+(e.charCodeAt(r)-64);return t-1};console.log("Parsing agent response for operations...");let s=e.match(/```json\s*([\s\S]*?)```/);if(s)try{let e=JSON.parse(s[1]);if(console.log("Parsed JSON from agent:",e),e.operations&&Array.isArray(e.operations)){let t=e.operations.map((e,t)=>{if(console.log("Processing operation:",e),"cell_update"===e.type){let s=a(e.column.toUpperCase()),n=r[s]?.id||`col_${s}`,l=e.row;return console.log("Cell update row mapping:",{agentRow:e.row,rowId:`r${l}`,column:e.column,columnId:n,value:e.value}),{id:`op-${Date.now()}-${t}`,type:"cell_update",rowId:`r${l}`,columnId:n,newValue:String(e.value),author:"agent"}}if("row_insert"===e.type){let a=`r-new-${Date.now()}-${t}`;if(Array.isArray(e.values))return e.values.map((e,s)=>{let n=r[s];return{id:`op-${Date.now()}-insert-${t}-${s}`,type:"cell_update",rowId:a,columnId:n?.id||`col_${s}`,newValue:String(e),author:"agent"}})}else if("row_delete"===e.type){let r=e.row;return{id:`op-${Date.now()}-del-${t}`,type:"row_delete",rowId:`r${r}`,author:"agent"}}else if("sort"===e.type)return Array.isArray(e.sorted_data)?e.sorted_data.flatMap((e,t)=>r.map((r,a)=>({id:`op-${Date.now()}-sort-${t}-${a}`,type:"cell_update",rowId:`r${t+1}`,columnId:r.id,newValue:String(e[a]??""),author:"agent"}))):{id:`op-${Date.now()}-sort-${t}`,type:"sort",columnId:r[a(e.column?.toUpperCase()||"A")]?.id,direction:e.direction||"asc",author:"agent"};return null}).flat().filter(Boolean);return console.log("Final operations:",t),t}if(Array.isArray(e))return e.map((e,t)=>{if("row_insert"===e.type){let a=`r-inserted-${Date.now()}-${t}`;return Array.isArray(e.values)?e.values.map((e,s)=>{let n=r[s];return{id:`op-${Date.now()}-insert-${t}-${s}`,type:"cell_update",rowId:a,columnId:n?.id||`col_${s}`,newValue:e,author:"agent"}}):{id:`op-${Date.now()}-insert-${t}`,type:"row_insert",rowId:a,author:"agent"}}return{id:`op-${Date.now()}-${t}`,type:e.type||"cell_update",rowId:e.rowId,columnId:e.columnId,oldValue:e.oldValue,newValue:e.newValue,author:"agent"}}).flat()}catch(e){console.error("Failed to parse operations JSON:",e,"Raw:",s[1])}let n=e.match(/delete\s+row\s+(\d+)/gi);return n&&n.forEach((e,r)=>{let a=e.match(/\d+/)?.[0];a&&o[parseInt(a)-1]&&t.push({id:`op-${Date.now()}-del-${r}`,type:"row_delete",rowId:o[parseInt(a)-1].id,author:"agent"})}),t},[o,r]),M=async()=>{if("agent"!==e||!b.trim())return;E.current&&E.current.abort(),E.current=new AbortController;let t={id:`u-${Date.now()}`,from:"user",text:b.trim()};y(e=>[...e,t]),f(""),x?.(t.text);let r=`a-${Date.now()}`;y(e=>[...e,{id:r,from:"agent",text:"",isStreaming:!0}]),v("thinking");try{let e=N?"PUT":"POST",a=await fetch("/api/chat/proxy",{method:e,headers:{"Content-Type":"application/json"},body:JSON.stringify({message:t.text,runId:N,userId:m||"anonymous"}),signal:E.current.signal});if(!a.ok)throw Error(`Request failed: ${a.status}`);let s=a.headers.get("X-Toolhouse-Run-ID");s&&S(s);let n=a.body?.getReader();if(!n)throw Error("No response body");let l=new TextDecoder,o="";for(v("streaming");;){let{done:e,value:t}=await n.read();if(e)break;let a=l.decode(t,{stream:!0});if(o+=a,"AUTH_REQUIRED"===o.trim()){v("auth_required"),y(e=>e.filter(e=>e.id!==r));break}y(e=>e.map(e=>e.id===r?{...e,text:o}:e))}if(y(e=>e.map(e=>e.id===r?{...e,isStreaming:!1}:e)),o&&"AUTH_REQUIRED"!==o.trim()){let e=R(o);console.log("Parsed operations from agent:",e),e.length>0&&h(e)}v("idle")}catch(e){if("AbortError"===e.name)return;console.error("Agent error:",e),y(e=>e.map(e=>e.id===r?{...e,text:"Sorry, something went wrong. Please try again.",isStreaming:!1}:e)),v("idle")}finally{E.current=null}},F={idle:{color:"bg-gray-400",label:"Idle"},thinking:{color:"bg-yellow-400 animate-pulse",label:"Thinking..."},streaming:{color:"bg-green-400 animate-pulse",label:"Responding..."},auth_required:{color:"bg-red-400",label:"Auth Required"}};return a.jsx(a.Fragment,{children:_&&!O?a.jsx(l,{sheetName:d||i||"Sheet"}):(0,a.jsxs)("div",{className:"flex h-full flex-col overflow-hidden",children:[(0,a.jsxs)("div",{className:"mb-4 flex items-center justify-between",children:[a.jsx("div",{className:"text-lg font-semibold",children:"Agent"}),(0,a.jsxs)("div",{className:"flex items-center gap-2 text-xs text-gray-500",children:[a.jsx("span",{className:`h-2 w-2 rounded-full ${F[j].color}`}),F[j].label]})]}),$&&O?a.jsx("div",{className:"mb-4 rounded-lg border border-green-200 bg-green-50 p-3",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[a.jsx("span",{className:"text-green-600",children:a.jsx("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})})}),(0,a.jsxs)("div",{children:[a.jsx("div",{className:"text-sm font-medium text-green-800",children:"Connected"}),a.jsx("div",{className:"text-xs text-green-600 truncate max-w-[180px]",title:$.name,children:$.name})]})]}),a.jsx("button",{onClick:()=>{k(null),S(null),y([{id:`m-${Date.now()}`,from:"agent",text:"Disconnected from sheet. Select another sheet and connect to continue editing."}])},className:"text-xs text-green-600 hover:text-green-800 underline",children:"Disconnect"})]})}):i?(0,a.jsxs)("div",{className:"mb-4 flex flex-col items-center justify-center rounded-lg border-2 border-dashed border-gray-300 bg-gray-50 p-6",children:[a.jsx("div",{className:"mb-2 text-center text-sm text-gray-600",children:d||`Sheet ${i.slice(0,12)}...`}),a.jsx("button",{onClick:T,className:"rounded-lg bg-blue-600 px-6 py-2 text-sm font-medium text-white hover:bg-blue-700 transition-colors",children:"Connect to this Sheet"}),a.jsx("div",{className:"mt-2 text-xs text-gray-500 text-center",children:"Click to give the agent full access to edit this spreadsheet"})]}):a.jsx("div",{className:"mb-4 rounded-lg border border-yellow-200 bg-yellow-50 p-3 text-center text-sm text-yellow-700",children:"Select a sheet from the dropdown to get started"}),(0,a.jsxs)("div",{ref:A,className:"flex-1 overflow-auto space-y-3 p-2",children:[w.map(e=>a.jsx(n,{from:e.from,text:e.text||(e.isStreaming?"...":"")},e.id)),a.jsx("div",{className:"border-t border-gray-100 pt-2 text-sm text-gray-600",children:0===t.length?a.jsx("span",{children:"No pending changes"}):(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsxs)("div",{className:"font-medium text-gray-700",children:["Pending changes (",t.length,")"]}),a.jsx("ul",{className:"space-y-1 max-h-32 overflow-auto",children:t.map(e=>a.jsx("li",{children:(0,a.jsxs)("button",{className:"text-left underline text-xs","aria-label":"Preview pending change",onClick:p,children:[e.type,": ",e.rowId??"-"," \xb7 ",e.columnId??"-",e.newValue?` → "${e.newValue}"`:""]})},e.id))})]})}),u.length>0&&(0,a.jsxs)("div",{className:"border-t border-gray-100 pt-2 text-sm text-gray-600",children:[(0,a.jsxs)("div",{className:"font-medium text-gray-700",children:["Validation issues (",u.length,")"]}),a.jsx("ul",{className:"mt-1 space-y-1 max-h-24 overflow-auto",children:u.map(e=>(0,a.jsxs)("li",{className:"text-xs text-red-600",children:[e.rowId," \xb7 ",e.columnId,": ",e.message]},e.id))})]})]}),(0,a.jsxs)("div",{className:"flex flex-col gap-2 border-t border-gray-100 bg-white p-2",children:[a.jsx("textarea",{"aria-label":"Agent input",placeholder:$?"agent"===e?"Ask: remove duplicates, sort by amount, clean emails...":"Switch to Agent mode to use AI":"Connect to a sheet first to start editing",className:"w-full resize-none rounded-md border border-gray-300 px-2 py-1.5 text-sm disabled:bg-gray-100 disabled:text-gray-500",rows:2,value:b,onChange:e=>f(e.target.value),onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),M())},disabled:!$||"agent"!==e||"streaming"===j||"thinking"===j}),a.jsx("button",{"aria-label":"Run agent",className:"rounded-md bg-black px-3 py-1.5 text-sm text-white disabled:opacity-50",onClick:M,disabled:!$||"agent"!==e||!b.trim()||"streaming"===j||"thinking"===j,children:"thinking"===j||"streaming"===j?"Processing...":"Run"})]})]})})}function i({mode:e,onChange:t,connecting:r,connected:s,onConnect:n,error:l}){return(0,a.jsxs)("div",{className:"flex flex-wrap items-center gap-3 text-sm",children:[(0,a.jsxs)("div",{className:"inline-flex rounded-md border border-gray-300 p-1",children:[a.jsx("button",{"aria-label":"Use app sheets",className:`px-3 py-1 rounded ${"service"===e?"bg-black text-white":"text-black"}`,onClick:()=>t("service"),children:"Use app sheets (no sign-in)"}),a.jsx("button",{"aria-label":"Use my Google Sheets",className:`px-3 py-1 rounded ${"oauth"===e?"bg-black text-white":"text-black"}`,onClick:()=>t("oauth"),children:"Use my Google Sheets"})]}),"oauth"===e&&(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[a.jsx("button",{"aria-label":"Connect Google Sheets",className:"rounded-md border border-gray-300 px-3 py-1.5",onClick:n,disabled:r,children:s?"Connected":r?"Connecting...":"Connect"}),l&&a.jsx("span",{className:"text-xs text-red-600",children:l})]})]})}var d=r(8958);let c=e=>String.fromCharCode(65+e);function m({sheetBefore:e,sheetAfter:t,ops:r,validationIssues:s,onClose:n}){let l=new Map;e.rows.forEach((e,t)=>l.set(e.id,t));let o=new Map;return e.columns.forEach((e,t)=>o.set(e.id,t)),a.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 px-4 py-6",children:(0,a.jsxs)(d.Z,{className:"w-full max-w-3xl",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[a.jsx("h3",{className:"text-lg font-medium",children:"Change Preview"}),a.jsx("button",{"aria-label":"Close preview",className:"rounded-md border border-gray-300 px-2 py-1 text-sm",onClick:n,children:"Close"})]}),a.jsx("div",{className:"mt-4 space-y-2 text-sm text-gray-700",children:0===r.length?a.jsx("div",{children:"No pending changes."}):r.map(r=>{if("cell_update"===r.type&&r.rowId&&r.columnId){let s=l.get(r.rowId)??0,n=o.get(r.columnId)??0,i=`${c(n)}${s+1}`,d=e.rows.find(e=>e.id===r.rowId)?.cells[r.columnId]??"",m=t.rows.find(e=>e.id===r.rowId)?.cells[r.columnId]??r.newValue??"";return(0,a.jsxs)("div",{children:[i,": ",d||"—"," → ",m||"—"]},r.id)}return"column_add"===r.type?(0,a.jsxs)("div",{children:["Added column: ",r.columnLabel??r.columnId]},r.id):"column_delete"===r.type?(0,a.jsxs)("div",{children:["Deleted column: ",r.columnId]},r.id):"add_row"===r.type&&r.row?(0,a.jsxs)("div",{children:["Added row: ",r.row.id]},r.id):"row_delete"===r.type?(0,a.jsxs)("div",{children:["Deleted row: ",r.rowId]},r.id):"sort"===r.type?(0,a.jsxs)("div",{children:["Sorted by ",r.columnId," (",r.direction,")"]},r.id):(0,a.jsxs)("div",{children:["Pending change (",r.type,")"]},r.id)})}),s.length>0&&(0,a.jsxs)("div",{className:"mt-6 border-t border-gray-100 pt-4 text-sm text-gray-700",children:[a.jsx("div",{className:"font-medium",children:"Validation issues"}),a.jsx("ul",{className:"mt-2 space-y-1",children:s.map(e=>(0,a.jsxs)("li",{children:[e.rowId," \xb7 ",e.columnId,": ",e.message]},e.id))})]})]})})}function u({mode:e,columns:t,rows:r,validationIssues:n,onCellCommit:l}){let[o,i]=(0,s.useState)(null),[d,c]=(0,s.useState)(""),m=(0,s.useMemo)(()=>{let e=new Map;return n.forEach(t=>{e.set(`${t.rowId}:${t.columnId}`,t.message)}),e},[n]),u=(t,r,a)=>{"manual"===e&&(i({rowId:t,columnId:r,oldValue:a}),c(a))},h=()=>{if(!o)return;let e=d.trim(),{rowId:t,columnId:r,oldValue:a}=o;i(null),l(t,r,a,e)},p=()=>{i(null),c("")};return a.jsx("div",{className:"w-full",children:(0,a.jsxs)("table",{className:"w-full border-collapse",children:[a.jsx("thead",{className:"bg-gray-100 text-left",children:a.jsx("tr",{children:t.map(e=>a.jsx("th",{className:"p-3 text-sm font-medium",children:e.label},e.id))})}),a.jsx("tbody",{children:r.map(r=>a.jsx("tr",{className:"odd:bg-white even:bg-gray-50",children:t.map(t=>{let s=r.cells[t.id]??"",n=o?.rowId===r.id&&o?.columnId===t.id,l=m.get(`${r.id}:${t.id}`);return a.jsx("td",{className:`p-3 text-sm ${"right"===t.align?"text-right":"text-left"} ${"manual"===e?"cursor-text":""} ${l?"text-red-600":""}`,title:l||("agent"===e?"Switch to Manual to edit":void 0),onClick:()=>u(r.id,t.id,s),children:n?a.jsx("input",{"aria-label":`${t.label} value`,className:"w-full rounded-md border border-gray-300 bg-white px-2 py-1 text-sm",value:d,autoFocus:!0,onChange:e=>c(e.target.value),onBlur:h,onKeyDown:e=>{"Enter"===e.key&&h(),"Escape"===e.key&&p()}}):a.jsx("span",{className:s?"":"text-gray-400",children:s||"—"})},t.id)})},r.id))})]})})}function h({columns:e,rows:t,columnId:r,onAddSummary:n}){let l=e.find(e=>e.id===r),o=(0,s.useMemo)(()=>{let e=t.map(e=>Number((e.cells[r]??"").trim())).filter(e=>!Number.isNaN(e)),a=e.length,s=e.reduce((e,t)=>e+t,0);return{count:a,total:s,average:a?s/a:0}},[t,r]);return(0,a.jsxs)("div",{children:[a.jsx("div",{className:"text-sm font-medium",children:"Summary preview"}),(0,a.jsxs)("div",{className:"mt-2 text-sm text-gray-600",children:[(0,a.jsxs)("div",{children:["Column: ",l?.label??"—"]}),(0,a.jsxs)("div",{children:["Count: ",o.count]}),(0,a.jsxs)("div",{children:["Total: ",o.total.toFixed(2)]}),(0,a.jsxs)("div",{children:["Average: ",o.average.toFixed(2)]})]}),a.jsx("button",{"aria-label":"Add summary row",className:"mt-3 rounded-md border border-gray-300 px-3 py-2 text-sm",onClick:()=>{if(!l)return;let t=e[0]?.id;n({id:`summary-${Date.now()}`,cells:{...t?{[t]:"Summary"}:{},[r]:o.total.toFixed(2)}})},children:"Add summary row"})]})}let p=e=>e.trim().toLowerCase().replace(/[^a-z0-9]+/g,"_").replace(/^_+|_+$/g,"");function x({columns:e,rows:t,onProposeOps:r,onValidate:n}){let[l,o]=(0,s.useState)(e[0]?.id??""),[i,c]=(0,s.useState)("asc"),[m,u]=(0,s.useState)(""),x=(0,s.useMemo)(()=>e.find(e=>e.id===l)?.label??"",[e,l]);return(0,a.jsxs)(d.Z,{children:[(0,a.jsxs)("div",{className:"mb-4 flex flex-wrap items-center justify-between gap-3",children:[a.jsx("h3",{className:"text-lg font-medium",children:"Tools"}),(0,a.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[a.jsx("label",{htmlFor:"columnSelect",className:"text-gray-600",children:"Column"}),a.jsx("select",{id:"columnSelect",className:"rounded-md border border-gray-300 bg-white px-2 py-1 text-sm",value:l,onChange:e=>o(e.target.value),children:e.map(e=>a.jsx("option",{value:e.id,children:e.label},e.id))})]})]}),(0,a.jsxs)("div",{className:"grid gap-2 md:grid-cols-2",children:[a.jsx("button",{"aria-label":"Remove duplicates",className:"rounded-md border border-gray-300 px-3 py-2 text-sm",onClick:()=>{if(!l)return;let e=new Set,a=[];t.forEach(t=>{let r=(t.cells[l]??"").trim();r&&(e.has(r)?a.push({id:`op-${Date.now()}-${t.id}`,type:"row_delete",rowId:t.id,author:"agent"}):e.add(r))}),r(a)},children:"Remove duplicates"}),a.jsx("button",{"aria-label":"Normalize emails",className:"rounded-md border border-gray-300 px-3 py-2 text-sm",onClick:()=>{if(!l)return;let e=[];t.forEach(t=>{let r=t.cells[l]??"",a=r.toLowerCase();r&&r!==a&&e.push({id:`op-${Date.now()}-${t.id}`,type:"cell_update",rowId:t.id,columnId:l,oldValue:r,newValue:a,author:"agent"})}),r(e)},children:"Normalize emails"}),a.jsx("button",{"aria-label":"Add column",className:"rounded-md border border-gray-300 px-3 py-2 text-sm",onClick:()=>{let e=window.prompt("Column name","New Column");if(!e)return;let t=p(e)||`col_${Date.now()}`;r([{id:`op-${Date.now()}-col-add`,type:"column_add",columnId:t,columnLabel:e,author:"agent"}])},children:"Add column"}),a.jsx("button",{"aria-label":"Delete column",className:"rounded-md border border-gray-300 px-3 py-2 text-sm",onClick:()=>{let e=window.prompt("Column id to delete",l);e&&r([{id:`op-${Date.now()}-col-del`,type:"column_delete",columnId:e,author:"agent"}])},children:"Delete column"}),a.jsx("button",{"aria-label":"Add row",className:"rounded-md border border-gray-300 px-3 py-2 text-sm",onClick:()=>{let a=window.prompt("Row id",`r${t.length+1}`);if(!a)return;let s={id:a,cells:Object.fromEntries(e.map(e=>[e.id,""]))};r([{id:`op-${Date.now()}-row-add`,type:"add_row",row:s,author:"agent"}])},children:"Add row"}),a.jsx("button",{"aria-label":"Delete row",className:"rounded-md border border-gray-300 px-3 py-2 text-sm",onClick:()=>{let e=window.prompt("Row id to delete",t[t.length-1]?.id);e&&r([{id:`op-${Date.now()}-row-del`,type:"row_delete",rowId:e,author:"agent"}])},children:"Delete row"}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)("select",{"aria-label":"Sort direction",className:"rounded-md border border-gray-300 bg-white px-2 py-2 text-sm",value:i,onChange:e=>c(e.target.value),children:[a.jsx("option",{value:"asc",children:"Asc"}),a.jsx("option",{value:"desc",children:"Desc"})]}),(0,a.jsxs)("button",{"aria-label":"Sort by column",className:"flex-1 rounded-md border border-gray-300 px-3 py-2 text-sm",onClick:()=>{l&&r([{id:`op-${Date.now()}-sort`,type:"sort",columnId:l,direction:i,author:"agent"}])},children:["Sort by ",x||"column"]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[a.jsx("input",{"aria-label":"Filter value",className:"w-full rounded-md border border-gray-300 px-2 py-2 text-sm",placeholder:"Filter value",value:m,onChange:e=>u(e.target.value)}),a.jsx("button",{"aria-label":"Filter rows",className:"rounded-md border border-gray-300 px-3 py-2 text-sm",onClick:()=>{if(!l)return;let e=m.trim();e&&r(t.filter(t=>(t.cells[l]??"").trim()!==e).map(e=>({id:`op-${Date.now()}-filter-${e.id}`,type:"row_delete",rowId:e.id,author:"agent"})))},children:"Filter"})]})]}),a.jsx("div",{className:"mt-2 border-t border-gray-100 pt-2",children:a.jsx(h,{columns:e,rows:t,columnId:l,onAddSummary:e=>{r([{id:`op-${Date.now()}-summary`,type:"add_row",row:e,author:"agent"}])}})}),a.jsx("div",{className:"mt-2 border-t border-gray-100 pt-2",children:a.jsx("button",{"aria-label":"Validate data",className:"rounded-md border border-gray-300 px-3 py-2 text-sm",onClick:n,children:"Validate data"})})]})}let g=(e,t)=>{let r=e.slice(0,20).map(e=>(e.cells[t]??"").trim()),a=0,s=0,n=0,l=0;return(r.forEach(e=>{if(e){if(/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)){a+=1;return}if(!Number.isNaN(Number(e))){s+=1;return}if(!Number.isNaN(Date.parse(e))){n+=1;return}l+=1}}),a>=Math.max(s,n,l))?"email":s>=Math.max(a,n,l)?"number":n>=Math.max(a,s,l)?"date":"string"},b=(e,t)=>{let r=[];return e.forEach(e=>{let a=g(t,e.id);t.forEach(t=>{let s=(t.cells[e.id]??"").trim();s&&("email"!==a||/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s)||r.push({id:`val-${t.id}-${e.id}`,rowId:t.id,columnId:e.id,message:"Invalid email format"}),"number"===a&&Number.isNaN(Number(s))&&r.push({id:`val-${t.id}-${e.id}`,rowId:t.id,columnId:e.id,message:"Expected a number"}))})}),r},f=(e,t)=>{let r=[...e.columns],a=e.rows.map(e=>({...e,cells:{...e.cells}}));return t.forEach(e=>{if("cell_update"===e.type&&e.rowId&&e.columnId){let t=e.rowId.startsWith("r-new-")||e.rowId.startsWith("r-inserted-"),s=a.find(t=>t.id===e.rowId);if(t&&!s){let t={id:e.rowId,cells:Object.fromEntries(r.map(e=>[e.id,""]))};a=[...a,t]}a=a.map(t=>t.id===e.rowId?{...t,cells:{...t.cells,[e.columnId]:e.newValue??""}}:t)}if("column_add"===e.type&&e.columnId&&(r=[...r,{id:e.columnId,label:e.columnLabel??e.columnId}],a=a.map(t=>({...t,cells:{...t.cells,[e.columnId]:""}}))),"column_delete"===e.type&&e.columnId&&(r=r.filter(t=>t.id!==e.columnId),a=a.map(t=>{let r={...t.cells};return delete r[e.columnId],{...t,cells:r}})),"add_row"===e.type&&e.row&&(a=[...a,e.row]),"row_delete"===e.type&&e.rowId&&(a=a.filter(t=>t.id!==e.rowId)),"sort"===e.type&&e.columnId){let t=e.direction??"asc";a=[...a].sort((r,a)=>{let s=(r.cells[e.columnId]??"").toString(),n=(a.cells[e.columnId]??"").toString(),l=s.localeCompare(n,void 0,{numeric:!0});return"asc"===t?l:-l})}}),{...e,columns:r,rows:a}};function w({params:e}){let{sheetId:t}=e,[r,n]=(0,s.useState)("agent"),[l,c]=(0,s.useState)(()=>"oauth"),[h,p]=(0,s.useState)("anonymous"),[g,w]=(0,s.useState)(null),[y,j]=(0,s.useState)(!1),[v,N]=(0,s.useState)(null),[S,I]=(0,s.useState)(null),[C,$]=(0,s.useState)(!1),[k,_]=(0,s.useState)(!1),[D,O]=(0,s.useState)(t),[P,A]=(0,s.useState)(!1),[E,T]=(0,s.useState)(null),[R,M]=(0,s.useState)([]),[F,V]=(0,s.useState)(!1),[G,L]=(0,s.useState)(null),[U,q]=(0,s.useState)([]),[J,z]=(0,s.useState)("Sheet1"),[B,Y]=(0,s.useState)(!1),Z=(0,s.useMemo)(()=>({columns:[{id:"name",label:"Name"},{id:"email",label:"Email"},{id:"amount",label:"Amount",align:"right"}],rows:"sample"===t?[{id:"r1",cells:{name:"Alice Smith",email:"alice@example.com",amount:"1200"}},{id:"r2",cells:{name:"Bob Chen",email:"bob@example.com",amount:"540"}},{id:"r3",cells:{name:"Cara Diaz",email:"cara@example.com",amount:"2300"}}]:[{id:"r1",cells:{name:"",email:"",amount:""}},{id:"r2",cells:{name:"",email:"",amount:""}},{id:"r3",cells:{name:"",email:"",amount:""}}],pendingOps:[]}),[t]),[W,X]=(0,s.useState)(Z),H=(0,s.useRef)(Z),[K,Q]=(0,s.useState)([]),[ee,et]=(0,s.useState)(!1),er=async e=>{let t=e||E;V(!0);try{let e=t?`/api/composio/sheets?userId=${h}&connectedAccountId=${t}`:`/api/composio/sheets?userId=${h}`,r=await fetch(e),a=await r.json();console.log("Load sheets response:",a),a.error&&console.error("Sheet listing error:",a.error,a.debug),M(a.sheets??[])}catch(e){console.error("Failed to load sheets:",e)}finally{V(!1)}},ea=async(e,t)=>{let r=t||E;if(e&&ei(e)){Y(!0);try{let t=r?`/api/composio/sheet-tabs?spreadsheetId=${e}&connectedAccountId=${r}`:`/api/composio/sheet-tabs?spreadsheetId=${e}&userId=${h}`,a=await fetch(t),s=await a.json();console.log("Load tabs response:",s);let n=s.tabs??[{id:0,name:"Sheet1"}];q(n),n.length>0&&!n.find(e=>e.name===J)&&z(n[0].name)}catch(e){console.error("Failed to load sheet tabs:",e),q([{id:0,name:"Sheet1"}])}finally{Y(!1)}}},es=W.pendingOps.length,en=async()=>{if(console.log("handleApply called:",{pendingOps:W.pendingOps.length,authMode:l,composioConnected:P,composioAccountId:E}),0===W.pendingOps.length){console.log("No pending ops, returning early");return}if(N(null),"oauth"===l&&P){console.log("Using Composio Push flow..."),await em();return}if("oauth"===l&&!g){N("Connect your Google account first.");return}try{let e=await fetch("/api/sheets/execute",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sheetId:t,ops:W.pendingOps,mode:l,oauthTokens:"oauth"===l?g:void 0})});if(!e.ok){let t=await e.json().catch(()=>({}));N(t.error??"Execution failed.");return}let r=f(H.current,W.pendingOps);H.current={...r,pendingOps:[]},X({...r,pendingOps:[]}),Q([]),et(!1),I(new Date().toISOString())}catch(e){N("Network error while syncing.")}},el=async()=>{j(!0),N(null);try{let e=await fetch("/api/composio/connection",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:h,app:"google_sheets",redirectUrl:window.location.href})}),t=await e.json();if(console.log("Connect response:",t),t.error){N(`Connection failed: ${t.error}`);return}t.redirectUrl?window.location.href=t.redirectUrl:N("No redirect URL returned. Check Composio setup.")}catch(e){console.error("Connect error:",e),N("Failed to connect to Google Sheets.")}finally{j(!1)}},eo=e=>e.trim().toLowerCase().replace(/[^a-z0-9]+/g,"_").replace(/^_+|_+$/g,""),ei=e=>"sample"!==e&&"new"!==e&&e.trim().length>5,ed=async()=>{if(!ei(t)){N("Enter a real Google Sheet ID to sync.");return}$(!0),N(null);try{let e=await fetch("/api/sheets/read",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sheetId:t,mode:l,oauthTokens:"oauth"===l?g:void 0})});if(!e.ok){let t=await e.json().catch(()=>({}));N(t.error??"Read failed.");return}let r=(await e.json()).result.values??[];if(0===r.length)return;let a=r[0].map((e,t)=>({id:eo(e)||`col_${t+1}`,label:e||`Column ${t+1}`})),s=r.slice(1).map((e,t)=>({id:`r${t+1}`,cells:Object.fromEntries(a.map((t,r)=>[t.id,e[r]??""]))})),n={columns:a,rows:s,pendingOps:[]};H.current=n,X(n),Q([]),I(new Date().toISOString())}catch(e){N("Failed to load sheet data.")}finally{$(!1)}},ec=async(e,r)=>{let a=G?.id||t,s=e||E,n=r||J;if(!ei(a)){N("Select a sheet first.");return}$(!0),N(null);try{let e=`${n}!A1:Z1000`;console.log("Pulling from range:",e);let t=await fetch("/api/composio/sheets",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:h,sheetId:a,connectedAccountId:s,range:e})}),r=await t.json();if(r.error){N(r.error);return}let l=r.values??[];if(0===l.length){N("Sheet is empty.");return}let o=l[0].map((e,t)=>({id:eo(e)||`col_${t+1}`,label:e||`Column ${t+1}`})),i=l.slice(1).map((e,t)=>({id:`r${t+1}`,cells:Object.fromEntries(o.map((t,r)=>[t.id,e[r]??""]))})),d={columns:o,rows:i,pendingOps:[]};H.current=d,X(d),Q([]),I(new Date().toISOString())}catch(e){console.error("Pull failed:",e),N("Failed to pull sheet data.")}finally{$(!1)}},em=async()=>{let e=G?.id||t;if(console.log("Push started:",{targetSheetId:e,composioAccountId:E,selectedTab:J,pendingOps:W.pendingOps.length}),!ei(e)){N("Select a sheet first.");return}if(0===W.pendingOps.length){N("No changes to push.");return}_(!0),N(null);try{let t=W.pendingOps.length>0?f(H.current,W.pendingOps):W,r=t.columns.map(e=>e.label),a=t.rows.map(e=>t.columns.map(t=>e.cells[t.id]??"")),s=[r,...a];console.log("Pushing data:",{rows:s.length,cols:s[0]?.length,sheetName:J});let n=await fetch("/api/composio/push",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:h,sheetId:e,sheetName:J,connectedAccountId:E,fullData:s})}),l=await n.json();if(console.log("Push response:",l),l.error){N(l.error+(l.details?`: ${l.details}`:""));return}H.current={...t,pendingOps:[]},X({...t,pendingOps:[]}),et(!1),I(new Date().toISOString())}catch(e){console.error("Push failed:",e),N("Failed to push changes.")}finally{_(!1)}},eu=e=>{L(e),O(e.id),window.location.href=`/sheet/${e.id}`},eh=(0,s.useMemo)(()=>0===W.pendingOps.length?W:f(H.current,W.pendingOps),[W.pendingOps,W,H]);return(0,a.jsxs)("div",{className:"min-h-screen bg-white text-black antialiased",children:[(0,a.jsxs)("main",{className:"max-w-7xl mx-auto px-1 py-12",children:[(0,a.jsxs)("header",{className:"mb-6 flex flex-wrap items-center justify-between gap-4",children:[a.jsx("nav",{children:a.jsx("a",{href:"/",className:"text-sm underline","aria-label":"Back",children:"Back"})}),(0,a.jsxs)("div",{className:"flex flex-wrap items-center gap-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[a.jsx("span",{className:"text-gray-600",children:"Mode"}),(0,a.jsxs)("div",{className:"inline-flex rounded-md border border-gray-300 p-1",children:[a.jsx("button",{"aria-label":"Switch to Agent mode",className:`px-3 py-1 rounded ${"agent"===r?"bg-black text-white":"text-black"}`,onClick:()=>n("agent"),children:"Agent"}),a.jsx("button",{"aria-label":"Switch to Manual mode",className:`px-3 py-1 rounded ${"manual"===r?"bg-black text-white":"text-black"}`,onClick:()=>n("manual"),children:"Manual"})]})]}),a.jsx(i,{mode:l,onChange:c,connecting:y,connected:!!g,onConnect:el,error:"oauth"===l?v:null})]})]}),"service"===l&&v&&a.jsx("div",{className:"mb-4 text-sm text-red-600",children:v}),(0,a.jsxs)("div",{className:"flex flex-col md:flex-row md:items-stretch gap-6",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)(d.Z,{children:[(0,a.jsxs)("header",{className:"flex flex-wrap items-start justify-between gap-3",children:[a.jsx("h2",{className:"text-xl font-medium",children:"Sheet Preview"}),(0,a.jsxs)("div",{className:"text-sm text-gray-600 text-right",children:[a.jsx("div",{children:"Backup created: backup_YYYYMMDD"}),S&&(0,a.jsxs)("div",{children:["Last synced: ",new Date(S).toLocaleTimeString()]})]})]}),(0,a.jsxs)("div",{className:"mt-4 flex items-center justify-between text-sm text-gray-600",children:[a.jsx("span",{children:0===es?"No pending changes":`${es} pending changes`}),es>0&&(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[a.jsx("button",{"aria-label":"Preview changes",className:"rounded-md border border-gray-300 px-3 py-1.5",onClick:()=>et(!0),children:"Preview changes"}),a.jsx("button",{"aria-label":"Apply pending changes",className:"rounded-md bg-black px-3 py-1.5 text-white",onClick:en,children:"Apply"}),a.jsx("button",{"aria-label":"Discard pending changes",className:"rounded-md border border-gray-300 px-3 py-1.5",onClick:()=>{X({...H.current,pendingOps:[]}),Q([]),et(!1)},children:"Discard"})]})]}),(0,a.jsxs)("div",{className:"mt-2 flex flex-wrap items-center gap-2 text-sm text-gray-600",children:["oauth"===l&&P&&(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)("select",{"aria-label":"Select sheet",className:"w-64 rounded-md border border-gray-300 px-2 py-1.5 text-sm",value:G?.id||t,onChange:e=>{let t=R.find(t=>t.id===e.target.value);t&&eu(t)},disabled:F,children:[a.jsx("option",{value:"",children:F?"Loading sheets...":"Select a sheet..."}),R.map(e=>a.jsx("option",{value:e.id,children:e.name},e.id))]}),a.jsx("button",{"aria-label":"Refresh sheets list",className:"rounded-md border border-gray-300 px-2 py-1.5",onClick:()=>er(),disabled:F,children:"↻"})]}),"oauth"===l&&P&&ei(G?.id||t)&&(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[a.jsx("span",{className:"text-gray-500",children:"Tab:"}),a.jsx("select",{"aria-label":"Select worksheet tab",className:"w-40 rounded-md border border-gray-300 px-2 py-1.5 text-sm",value:J,onChange:e=>{z(e.target.value),ec(E??void 0,e.target.value)},disabled:B,children:B?a.jsx("option",{value:"",children:"Loading tabs..."}):0===U.length?a.jsx("option",{value:"Sheet1",children:"Sheet1"}):U.map(e=>a.jsx("option",{value:e.name,children:e.name},e.id))}),a.jsx("button",{"aria-label":"Refresh tabs list",className:"rounded-md border border-gray-300 px-2 py-1.5",onClick:()=>ea(G?.id||t),disabled:B,children:"↻"})]}),("service"===l||!P)&&(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[a.jsx("input",{"aria-label":"Sheet ID",className:"w-64 rounded-md border border-gray-300 px-2 py-1.5 text-sm",placeholder:"Paste Google Sheet ID",value:D,onChange:e=>O(e.target.value)}),a.jsx("button",{"aria-label":"Go to sheet",className:"rounded-md border border-gray-300 px-3 py-1.5",onClick:()=>{D.trim()&&(window.location.href=`/sheet/${D.trim()}`)},children:"Go"})]}),(0,a.jsxs)("button",{"aria-label":"Pull from Google Sheets",className:"rounded-md border border-gray-300 px-3 py-1.5 flex items-center gap-1",onClick:()=>"oauth"===l&&P?ec():ed(),disabled:C,children:[a.jsx("span",{children:"↓"}),C?"Pulling...":"Pull"]}),(0,a.jsxs)("button",{"aria-label":"Push to Google Sheets",className:`rounded-md px-3 py-1.5 flex items-center gap-1 ${es>0?"bg-black text-white":"border border-gray-300 text-gray-400"}`,onClick:em,disabled:k||0===es,children:[a.jsx("span",{children:"↑"}),k?"Pushing...":`Push${es>0?` (${es})`:""}`]}),v&&a.jsx("span",{className:"text-red-600",children:v})]}),a.jsx("div",{className:"mt-4 max-h-[420px] overflow-auto rounded-md border border-gray-100",children:a.jsx(u,{mode:r,columns:W.columns,rows:W.rows,onCellCommit:(e,t,r,a)=>{if(a===r)return;let s={id:`op-${Date.now()}`,type:"cell_update",rowId:e,columnId:t,oldValue:r,newValue:a,author:"user"};X(r=>({...r,rows:r.rows.map(r=>r.id===e?{...r,cells:{...r.cells,[t]:a}}:r),pendingOps:[...r.pendingOps,s]}))},validationIssues:K})}),(0,a.jsxs)("div",{className:"mt-4 flex flex-wrap items-center gap-3",children:[a.jsx("a",{"aria-label":"Open in Google Sheets",className:"rounded-md border border-gray-300 px-3 py-2 text-sm text-gray-700",href:`https://docs.google.com/spreadsheets/d/${t}`,target:"_blank",rel:"noreferrer",children:"Open in Google Sheets"}),a.jsx("button",{"aria-label":"Download CSV",className:"rounded-md border border-gray-300 px-3 py-2 text-sm text-gray-700",children:"Download CSV"})]})]}),a.jsx("div",{className:"mt-4",children:a.jsx(x,{columns:W.columns,rows:W.rows,onProposeOps:e=>{e.length&&(X(t=>({...t,pendingOps:[...t.pendingOps,...e]})),et(!0))},onValidate:()=>{Q(b(W.columns,W.rows)),et(!0)}})})]}),a.jsx("div",{className:"w-full md:w-[420px] md:sticky md:top-6 md:h-[calc(100vh-140px)] self-start",children:a.jsx(d.Z,{className:"h-full",children:a.jsx(o,{mode:r,pendingOps:W.pendingOps,columns:W.columns,rows:W.rows,sheetId:G?.id||t,sheetName:G?.name,tabName:J,userId:h,onProposeOps:e=>{e.length&&(X(t=>({...t,pendingOps:[...t.pendingOps,...e]})),et(!0))},validationIssues:K,onPreview:()=>et(!0),onAgentComplete:()=>{console.log("Agent completed. Pending ops ready for review.")}})})})]})]}),ee&&a.jsx(m,{sheetBefore:H.current,sheetAfter:eh,ops:W.pendingOps,validationIssues:K,onClose:()=>et(!1)})]})}},3460:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>l,metadata:()=>n});var a=r(9510);r(7272);let s=(0,r(8570).createProxy)(String.raw`/home/aadit/sheet-ops/app/components/GlobalClickSpark.tsx#default`),n={title:"SheetOps - Automate Your Spreadsheet Tasks",description:"AI-powered spreadsheet automation with Google Sheets integration"};function l({children:e}){return a.jsx("html",{lang:"en",children:a.jsx("body",{children:a.jsx(s,{children:e})})})}},4280:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>a});let a=(0,r(8570).createProxy)(String.raw`/home/aadit/sheet-ops/app/sheet/[sheetId]/page.tsx#default`)},7272:()=>{}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[276,471],()=>r(4703));module.exports=a})();